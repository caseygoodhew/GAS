<script>
const predictorDebugModule = (() => {
  
  let bus = null;

  const makeJson = () => {
    return bus.relayActive().getData()
  };

  /**
   * Helper function to wrap JSON elements in styled spans
   */
  const syntaxHighlight = (json) => {
    if (typeof json !== 'string') {
      json = JSON.stringify(json, undefined, 2);
    }
    
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    
    const regex = /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g;
    
    return json.replace(regex, (match) => {
      let cls = 'json-number';
      
      if (/^"/.test(match)) {
        if (/:$/.test(match)) {
          cls = 'json-key';
        } else {
          // Check if the string value matches the 9-char alphanumeric ID pattern
          const valueContent = match.slice(1, -1);
          const idRegex = /^[a-z0-9]{9}$/;
          
          if (idRegex.test(valueContent)) {
            cls = 'json-id';
          } else {
            cls = 'json-string';
          }
        }
      } else if (/true|false/.test(match)) {
        cls = 'json-boolean';
      } else if (/null/.test(match)) {
        cls = 'json-null';
      }
      
      return `<span class="${cls}">${match}</span>`;
    });
  };

  /**
   * Copies the current appState JSON to the clipboard with SVG feedback
   */
  const copyDebugToClipboard = (event) => {
    const json = JSON.stringify(makeJson(), null, 2);
    const btn = event.currentTarget;
    const originalIcon = btn.innerHTML;
    
    const checkIcon = `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>`;

    navigator.clipboard.writeText(json).then(() => {
      btn.innerHTML = checkIcon;
      btn.classList.add('copy-success');

      setTimeout(() => {
        btn.innerHTML = originalIcon;
        btn.classList.remove('copy-success');
      }, 100);
    }).catch(err => {
      console.error('Clipboard error:', err);
      showAlert('Error', 'Failed to copy to clipboard.');
    });
  };

  return {
    init: ({ bus: _bus }) => {
      bus = _bus;
    },
    activate: () => {
      const debugContainer = document.getElementById('debug-state');
      if (debugContainer) {
        const jsonString = JSON.stringify(makeJson(), null, 2);
        // Use innerHTML instead of textContent to render the spans
        debugContainer.innerHTML = syntaxHighlight(jsonString);
      }
    },
    copyDebugToClipboard,
  }
})();
//# sourceURL=js_debug.js
</script>