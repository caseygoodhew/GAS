<script>
const predictorModuleController = (() => {

  const USE_SAMPLE_DATA = true;

  const constants = [
    'LAUNCHER',
    'REGISTRY', 
    //'ACTUALS', 
    'MOVEMENTS', 
    'DEBUG'
  ].reduce((acc, val) => ({ ...acc, [val]: val }), {});
  
  const {
    LAUNCHER,
    REGISTRY,
    //ACTUALS,
    MOVEMENTS,
    DEBUG
  } = constants;

  const INITIAL_MODULE = LAUNCHER;
  
  const moduleMap = {
    [LAUNCHER]: predictorLauncherModule,
    [REGISTRY]: predictorRegistryModule,
    [MOVEMENTS]: predictorMovementsModule,
    [DEBUG]: predictorDebugModule
  }
  
  const bus = {
    relay: (target) => {
      return moduleMap[target];
    },

    relayActive: () => {
      const activeModule = document.getElementById('module-container').dataset.activeModule;
      console.log(`relayActive to ${activeModule || 'undefined'}`)
      return bus.relay(activeModule);
    }
  }

  const initModules = (initData) => {
    Object.keys(constants).forEach(moduleKey => {
      console.log(moduleKey)
      moduleMap[moduleKey].init({
        moduleKey,
        bus,
        constants,
        data: initData[moduleKey]
      });
    });
  }

  const init = () => {
      /**
     * Initial Load
     */
    if (USE_SAMPLE_DATA) {
      initModules(getSampleData());
    } else {
      remoteCall({
        handler: (api) => api.getInitialData(),
        spinner: 'Loading configuration...',
        success: initModules,
        failure: 'Failed to load initial data'
      });
    }

    if (INITIAL_MODULE) {
      if (INITIAL_MODULE === LAUNCHER) {
        goHome();
      } else {
        navigate(INITIAL_MODULE);
      }
    }
  }

  const goHome = () => {
    navigate(LAUNCHER)
  };

  const goBackFromDebug = () => {
    navigate(document.getElementById('module-container').dataset.activeModule || LAUNCHER)
  };

  const navigate = (key) => {
    
    // Hide all modules
    document.querySelectorAll('.module-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.btn-back').forEach(el => el.classList.add('hidden'));
    
    if (key === DEBUG) { 
      document.getElementById('back-from-debug').classList.remove('hidden');
    } else {
      document.getElementById('back-home').classList.remove('hidden');
    }
    
    // Show selected
    const targetId = `module-${constants[key].toLowerCase()}`;
    if (!document.getElementById(targetId)) {
      throw new Error(`Are you sure that you've included the ${key} module html?`)
    }
    
    document.getElementById(targetId).classList.add('active');
    const moduleContainer = document.getElementById('module-container');
    moduleContainer.className = `for-${targetId}`;
    
    if (key !== DEBUG) { 
      document.getElementById('current-module-title').innerText = key;
      moduleContainer.dataset.activeModule = key;
    }

    // Trigger module activation
    bus.relay(constants[key]).activate();
  };
  
  return {
    init,
    navigate,
    goHome,
    goBackFromDebug
  }
})();

document.addEventListener('DOMContentLoaded', predictorModuleController.init);
//# sourceURL=js_main.js
</script>