<script>
const predictorModuleController = (() => {

  const USE_SAMPLE_DATA = true;

  const constants = ['REGISTRY', 'ACTUALS', 'MOVEMENTS', 'DEBUG'].reduce((acc, val) => ({ ...acc, [val]: val }), {});
  
  const {
    REGISTRY,
    ACTUALS,
    MOVEMENTS,
    DEBUG
  } = constants;

  const INITIAL_MODULE = REGISTRY;
  
  const moduleMap = {
    [SETUP]: predictorSetupModule,
    [MOVEMENTS]: predictorMovementsModule,
    [DEBUG]: predictorDebugModule
  }
  
  const bus = {
    relay: (target) => {
      return moduleMap[target];
    }
  }

  const initModules = (initData) => {
    Object.keys(constants).forEach(moduleKey => {
      moduleMap[moduleKey].init({
        moduleKey,
        bus,
        constants,
        data: initData[moduleKey]
      })
    });
  }

  const init = () => {
      /**
     * Initial Load
     */
    if (USE_SAMPLE_DATA) {
      initModules(getSampleData());
    } else {
      remoteCall({
        handler: (api) => api.getInitialData(),
        spinner: 'Loading configuration...',
        success: initModules,
        failure: 'Failed to load initial data'
      });
    }

    if (INITIAL_MODULE) {
      navigate(INITIAL_MODULE);
    }
  }

  const goHome = () => {
    document.getElementById('main-launcher').style.display = 'grid';
    document.getElementById('module-container').style.display = 'none';
  };

  const navigate = (key) => {
    document.getElementById('main-launcher').style.display = 'none';
    document.getElementById('module-container').style.display = 'block';
    
    // Hide all modules
    document.querySelectorAll('.module-content').forEach(el => el.classList.remove('active'));
    
    // Show selected
    const targetId = `module-${constants[key].toLowerCase()}`;
    document.getElementById(targetId).classList.add('active');
    document.getElementById('current-module-title').innerText = key;
    
    // Trigger module activation
    bus.relay(constants[key]).activate();
  };
  
  return {
    init,
    navigate,
    goHome
  }
})();

document.addEventListener('DOMContentLoaded', predictorModuleController.init);

</script>