<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <?!= include('html/predictor/modal_stylesheet'); ?>
  </head>
  <body>

    <nav class="tabs">
      <button class="tab-link" onclick="openTab(event, 'tab-compare')">Compare</button>
      <button class="tab-link" onclick="openTab(event, 'tab-create')">Create</button>
      <button class="tab-link active" onclick="openTab(event, 'tab-setup')">Setup</button>
      <button class="tab-link" onclick="openTab(event, 'tab-debug')">Debug</button>
    </nav>

    <section id="tab-compare" class="tab-content">
      <p>Comparison view coming soon...</p>
    </section>

    <section id="tab-create" class="tab-content">
      <p>Movement entries coming soon...</p>
    </section>

    <section id="tab-setup" class="tab-content active">
      <div class="section-box">
        <h3>Account Owners</h3>
        <div id="owners-list"></div> 
        <div class="inline-input-group">
          <input type="text" id="new-owner-name" placeholder="Enter name..." onkeypress="handleOwnerKeyPress(event)">
          <button class="btn btn-secondary" onclick="addOwner()">+ Person</button>
        </div>
      </div>

      <div class="section-box">
        <h3>Accounts</h3>
        <div class="input-group">
          <label for="opening-date">Balance as of:</label>
          <input type="date" id="opening-date" onchange="updateOpeningDate(this.value)">
        </div>
        
        <div class="account-header">
          <div>Account Name</div>
          <div>Owner</div>
          <div>Currency</div>
          <div>Balance</div>
          <div>AER %</div>
          <div></div> 
        </div>

        <div id="accounts-list"></div> 
        
        <button class="btn btn-secondary" style="margin-top: 12px;" onclick="addAccount()">+ Account</button>
      </div>
    </section>

    <template id="owner-row-template">
      <div class="list-item">
        <span class="owner-name"></span>
        <button class="btn-icon" title="Remove Person">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </button>
      </div>
    </template>

    <template id="account-row-template">
      <div class="account-row">
        <div class="acc-col">
          <input type="text" class="field-name" placeholder="e.g. Savings">
        </div>
        
        <div class="acc-col">
          <select class="field-owner">
            <option value="" disabled selected>Select Owner...</option>
          </select>
        </div>
        
        <div class="acc-col">
          <select class="field-currency">
            <option value="GBP">GBP</option>
            <option value="USD">USD</option>
          </select>
        </div>
        
        <div class="acc-col">
          <input type="number" step="0.01" class="field-balance">
        </div>
        
        <div class="acc-col">
          <input type="number" step="0.01" class="field-aer">
        </div>
        
        <div class="acc-col-action">
          <button class="btn-icon field-delete" title="Remove Account">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </div>
    </template>

    <section id="tab-debug" class="tab-content">
      <div class="section-box">
        <div class="debug-header">
          <h3>Application State (JSON)</h3>
          <button class="btn-icon" onclick="copyDebugToClipboard(event)" title="Copy to Clipboard">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </button>
        </div>
        <p style="font-size: 0.85em; color: #666; margin-bottom: 10px;">
          This is a real-time view of the data that will be sent to the server.
        </p>
        <div class="debug-container">
          <pre id="debug-state"></pre>
        </div>
      </div>
    </section>

    <footer class="modal-footer">
      <div class="status-msg" id="save-status"></div>
      <button class="btn-save" onclick="handleSave()">Save Configuration</button>
    </footer>

    <?!= includeCommon(); ?>
    <?!= include('html/predictor/modal_javascript'); ?>
    <?!= include('html/predictor/modal_sample_data'); ?>
  </body>
</html>